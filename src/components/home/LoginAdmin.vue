<template>
    <section class="login-page">
        <div class="login-box-admin">
            <div class="bac-img-box">
                <img class="bac-left" src="@/assets/pic/login/background-img-left.png" alt="">
                <img class="bac-right" src="@/assets/pic/login/background-img-right.png" alt="">
            </div>

            <img src="@/assets/pic/login/logo.png" alt="" />
            <div class="memberid-box">
                <img src="@/assets/pic/login/memid-icon.png" alt="" />
                <input class="memberid" name="memId" type="text" placeholder="請輸入帳號" v-model="textData" />
            </div>
            <div class="password-box">
                <img src="@/assets/pic/login/pwd-icon.png" alt="" />
                <input class="password" name="memPsw" type="password" placeholder="請輸入密碼" maxlength="12" minlength="6"
                    v-model="pswData" />
            </div>
            <button @click="memLogin()">登入</button>
        </div>
    </section>
</template>

<script>
import { useAdminStore } from '@/store/adminState.js'; // 引入 Pinia store

export default {
    data() {
        return {
            textData: '',
            pswData: '',
        };
    },
    methods: {
        async memLogin() {
            try {
                const store = useAdminStore(); // 獲取 Pinia store 的實例

                // 構建 body
                const body = {
                    account: this.textData,
                    password: this.pswData
                };

                const response = await fetch(`http://localhost/g3_php/loginData.php`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }

                const result = await response.json();

                if (result.code === 200) {
                    const loggedInUser = result.data.user;
                    store.setCurrentUser(loggedInUser); // 設置當前用戶到 Pinia
                    alert("登入成功!");
                    this.textData = '';
                    this.pswData = '';
                    this.$router.push('/newsmanage');
                } else {
                    alert(result.msg);
                    this.textData = '';
                    this.pswData = '';
                }
            } catch (error) {
                console.error('登入失敗:', error);
                alert('登入失敗');
            }
        }
    }
};
</script>

<style lang="scss">
.login-page {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background-color: #b1241a;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: -2;

    .login-box-admin {
        width: 60%;
        height: 65%;
        background-color: #FFFBF6;
        border-radius: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1;

        .bac-img-box {
            width: 100%;
            height: 100%;
            position: absolute;
            z-index: -1;

            >img {
                width: 100%;
            }

            .bac-left {
                position: absolute;
                left: -35%;
                top: -35%;
            }

            .bac-right {
                position: absolute;
                right: -35%;
                bottom: -35%;
            }
        }

        >img {
            width: 25%;
            margin: 6% auto 0 auto;
        }

        .memberid-box {
            display: flex;
            align-items: center;
            margin: 4% auto 1% auto;

            >img {
                width: 40px;
                margin-right: 5%;
            }

            >input {
                border-radius: 10px;
                border: 1px solid #CB2E27;
                width: 300px;
                height: 40px;
                padding-left: 5%;
            }
        }

        .password-box {
            display: flex;
            align-items: center;
            margin: 0 auto 4% auto;

            >img {
                width: 40px;
                margin-right: 5%;
            }

            >input {
                border-radius: 10px;
                border: 1px solid #CB2E27;
                width: 300px;
                height: 40px;
                padding-left: 5%;
            }
        }

        >button {
            width: 125px;
            height: 50px;
            border: 1px solid #b1241a;
            background-color: #b1241a;
            color: white;
            border-radius: 20px;
            margin: 2% auto;

            &:hover {
                background-color: white;
                color: #b1241a;
            }
        }
    }
}
</style>
